<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>morph-navbar test</title>

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../morph-navbar.html">
    <link rel="import" href="../../morph-navbar-item/morph-navbar-item.html">
  </head>
  <body>
    <test-fixture id="BasicAndroidFixture">
      <template>
        <morph-navbar platform="android" selected="play">
          <morph-navbar-item platform="android" name="play" not-selected-image="../img/play_android.svg" selected-image="../img/play_android_selected.svg" selected></morph-navbar-item>
          <morph-navbar-item platform="android" name="favorite" not-selected-image="../img/favorite_android.svg" selected-image="../img/favorite_android_selected.svg"></morph-navbar-item>
          <morph-navbar-item platform="android" name="mic" not-selected-image="../img/mic_android.svg" selected-image="../img/mic_android_selected.svg"></morph-navbar-item>
        </morph-navbar>
      </template>
    </test-fixture>

    <test-fixture id="BasicIosFixture">
      <template>
        <morph-navbar platform="ios" selected="play">
          <morph-navbar-item platform="ios" name="play" not-selected-image="../img/play_ios.svg" selected-image="../img/play_ios_selected.svg"></morph-navbar-item>
          <morph-navbar-item platform="ios" name="favorite" not-selected-image="../img/favorite_ios.svg" selected-image="../img/favorite_ios_selected.svg"></morph-navbar-item>
          <morph-navbar-item platform="ios" name="mic" not-selected-image="../img/mic_ios.svg" selected-image="../img/mic_ios_selected.svg"></morph-navbar-item>
        </morph-navbar>
      </template>
    </test-fixture>

    <script>
      //check navbarItems length is same with the root navbar-item element length.

      describe('morph-navbar', function() {
        var promise;
        // testing default Android Navbar properties
        context('Android Default Navbar', function() {
          // declare variable for bar in this context only
          let bar, items, style;
          // Create a test fixture
          beforeEach(function() {
            // assigning item fixture for this context. This will automatically removed on the teardown phase of this test context
            bar = fixture('BasicAndroidFixture');
            items = bar.querySelectorAll('morph-navbar-item');
            style = getComputedStyle(bar);

          });

          it('instantiating the navbar on android platform with default properties works', function() {
            // testing for default properties and which platform was set in html markup
            expect(bar.platform).to.be.equal('android');
            expect(bar.hasAttribute('selected')).to.be.true;
            expect(bar.navbarItems).to.be.an('Array');
          });

          it('checking if the navbarItems property gets updated works', function() {
            expect(bar.navbarItems.length).to.be.equal(items.length);
          });

          it('Inner item selection works', function() {
            // testing for default innerItemClickHandler on android item
            var inner = sinon.spy(bar, 'innerItemClickHandler');
            items[1].click();

            expect(inner.callCount).to.be.equal(1);
            inner.restore();
          });

          it('Selected attribute gets updated after the click works', function() {
            var inner = sinon.spy(bar, 'innerItemClickHandler');
            items[1].click();

            expect(items[1].selected).to.be.true;
            expect(items[0].selected).to.be.false;
          })

          it('checking the selected value of navbar is the same with name of the selected item works ', function() {
            items[1].click();

            // testing for selected value data binding
            var barSelectedValue, itemSelectedName;
            barSelectedValue = bar.selected;

            for (var i=0; i<items.length; i++) {
              if (items[i].hasAttribute('selected')) {
                itemSelectedName = items[i].name;
                return;
              }
            }
            expect(barSelectedValue).to.be.equal(itemSelectedName);
          });
        });
      })
    </script>

  </body>
</html>
